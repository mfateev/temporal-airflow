<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 950 430" width="950" height="430">
  <defs>
    <marker id="arrowhead" markerWidth="6" markerHeight="5" refX="5" refY="2.5" orient="auto">
      <polygon points="0 0, 6 2.5, 0 5" fill="#374151"/>
    </marker>
    <marker id="arrowhead-purple" markerWidth="6" markerHeight="5" refX="5" refY="2.5" orient="auto">
      <polygon points="0 0, 6 2.5, 0 5" fill="#7c3aed"/>
    </marker>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="2" dy="2" stdDeviation="3" flood-opacity="0.15"/>
    </filter>
  </defs>

  <!-- Background -->
  <rect width="950" height="430" fill="#f8fafc"/>

  <!-- Title -->
  <text x="475" y="35" text-anchor="middle" font-family="Arial, sans-serif" font-size="22" font-weight="bold" fill="#1e293b">Airflow + Temporal Deep Integration</text>

  <!-- User Box -->
  <g transform="translate(30, 120)">
    <rect x="0" y="0" width="100" height="60" rx="8" fill="#f1f5f9" stroke="#94a3b8" stroke-width="2" filter="url(#shadow)"/>
    <text x="50" y="28" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#334155">User</text>
    <text x="50" y="46" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#64748b">UI / CLI / API</text>
  </g>

  <!-- Airflow Section -->
  <g transform="translate(160, 70)">
    <rect x="0" y="0" width="260" height="250" rx="10" fill="#dbeafe" stroke="#3b82f6" stroke-width="2" filter="url(#shadow)"/>
    <text x="130" y="25" text-anchor="middle" font-family="Arial, sans-serif" font-size="15" font-weight="bold" fill="#1e40af">AIRFLOW</text>

    <!-- API Server -->
    <rect x="15" y="40" width="230" height="55" rx="6" fill="white" stroke="#3b82f6" stroke-width="1.5"/>
    <text x="130" y="62" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#1e40af">API Server</text>
    <text x="130" y="80" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#64748b">TemporalOrchestrator</text>

    <!-- Scheduler -->
    <rect x="15" y="105" width="105" height="45" rx="6" fill="white" stroke="#3b82f6" stroke-width="1.5"/>
    <text x="67" y="125" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#1e40af">Scheduler</text>
    <text x="67" y="140" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#64748b">Timetables</text>

    <!-- DAG Processor -->
    <rect x="130" y="105" width="115" height="45" rx="6" fill="white" stroke="#3b82f6" stroke-width="1.5"/>
    <text x="187" y="125" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#1e40af">DAG Processor</text>
    <text x="187" y="140" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#64748b">Parse DAGs</text>

    <!-- Airflow DB -->
    <g transform="translate(40, 160)">
      <ellipse cx="90" cy="12" rx="75" ry="10" fill="#93c5fd" stroke="#3b82f6" stroke-width="1.5"/>
      <rect x="15" y="12" width="150" height="55" fill="#93c5fd" stroke="#3b82f6" stroke-width="1.5"/>
      <ellipse cx="90" cy="67" rx="75" ry="10" fill="#93c5fd" stroke="#3b82f6" stroke-width="1.5"/>
      <line x1="15" y1="12" x2="15" y2="67" stroke="#3b82f6" stroke-width="1.5"/>
      <line x1="165" y1="12" x2="165" y2="67" stroke="#3b82f6" stroke-width="1.5"/>
      <text x="90" y="35" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#1e40af">Airflow DB</text>
      <text x="90" y="50" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#1e40af">DagRun, TaskInstance</text>
      <text x="90" y="62" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#1e40af">Connections, Variables</text>
    </g>
  </g>

  <!-- Temporal Section -->
  <g transform="translate(470, 70)">
    <rect x="0" y="0" width="280" height="250" rx="10" fill="#dcfce7" stroke="#22c55e" stroke-width="2" filter="url(#shadow)"/>
    <text x="140" y="25" text-anchor="middle" font-family="Arial, sans-serif" font-size="15" font-weight="bold" fill="#15803d">TEMPORAL</text>

    <!-- Temporal Server -->
    <rect x="15" y="40" width="250" height="45" rx="6" fill="white" stroke="#22c55e" stroke-width="1.5"/>
    <text x="140" y="60" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#15803d">Temporal Server</text>
    <text x="140" y="75" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#64748b">Workflow history, retries, timeouts</text>

    <!-- Temporal Worker -->
    <rect x="15" y="115" width="250" height="120" rx="6" fill="white" stroke="#22c55e" stroke-width="1.5"/>
    <text x="140" y="133" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#15803d">Temporal Worker</text>

    <!-- Workflow box -->
    <rect x="25" y="142" width="230" height="42" rx="4" fill="#f0fdf4" stroke="#86efac" stroke-width="1"/>
    <text x="140" y="156" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#166534">ExecuteAirflowDagDeepWorkflow</text>

    <!-- Mini SQLite DB icon inside workflow box - centered -->
    <g transform="translate(95, 162)">
      <ellipse cx="12" cy="3" rx="11" ry="3" fill="#fde68a" stroke="#f59e0b" stroke-width="0.8"/>
      <rect x="1" y="3" width="22" height="10" fill="#fde68a" stroke="#f59e0b" stroke-width="0.8"/>
      <ellipse cx="12" cy="13" rx="11" ry="3" fill="#fde68a" stroke="#f59e0b" stroke-width="0.8"/>
      <line x1="1" y1="3" x2="1" y2="13" stroke="#f59e0b" stroke-width="0.8"/>
      <line x1="23" y1="3" x2="23" y2="13" stroke="#f59e0b" stroke-width="0.8"/>
    </g>
    <text x="140" y="178" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#64748b">In-memory SQLite</text>

    <!-- Activities box -->
    <rect x="25" y="189" width="230" height="40" rx="4" fill="#f0fdf4" stroke="#86efac" stroke-width="1"/>
    <text x="140" y="205" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#166534">Activities</text>
    <text x="140" y="218" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#64748b">run_airflow_task, sync_task_status, sync_dagrun_status</text>
  </g>

  <!-- External Systems -->
  <g transform="translate(790, 150)">
    <rect x="0" y="0" width="130" height="90" rx="8" fill="#fef3c7" stroke="#f59e0b" stroke-width="2" filter="url(#shadow)"/>
    <text x="65" y="25" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#b45309">External</text>
    <text x="65" y="40" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#b45309">Systems</text>
    <text x="65" y="58" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#78716c">AWS, GCP, DBs</text>
    <text x="65" y="72" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#78716c">APIs, Files</text>
  </g>

  <!-- Flow Arrows -->

  <!-- 1. User to API Server -->
  <line x1="130" y1="150" x2="157" y2="150" stroke="#374151" stroke-width="1.5" marker-end="url(#arrowhead)"/>
  <text x="143" y="143" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#374151">1</text>

  <!-- 2. API Server to Temporal Server -->
  <line x1="420" y1="137" x2="467" y2="137" stroke="#374151" stroke-width="1.5" marker-end="url(#arrowhead)"/>
  <text x="443" y="130" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#374151">2</text>

  <!-- 3. Temporal Server dispatches to Worker (longer arrow now) -->
  <line x1="610" y1="155" x2="610" y2="182" stroke="#374151" stroke-width="1.5" marker-end="url(#arrowhead)"/>
  <text x="622" y="172" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#374151">3</text>

  <!-- 4. Worker to External Systems -->
  <line x1="750" y1="215" x2="787" y2="195" stroke="#374151" stroke-width="1.5" marker-end="url(#arrowhead)"/>
  <text x="778" y="218" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#374151">4</text>

  <!-- 5. Sync back to Airflow DB -->
  <line x1="470" y1="280" x2="423" y2="280" stroke="#374151" stroke-width="1.5" marker-end="url(#arrowhead)"/>
  <text x="448" y="273" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#374151">5</text>

  <!-- Dashed: Load DAG from DB -->
  <path d="M 470 200 L 423 200" stroke="#7c3aed" stroke-width="1" stroke-dasharray="4,3" fill="none" marker-end="url(#arrowhead-purple)"/>
  <text x="447" y="193" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#7c3aed">Load DAG</text>

  <!-- Dashed: Read Connections -->
  <path d="M 470 240 L 423 240" stroke="#7c3aed" stroke-width="1" stroke-dasharray="4,3" fill="none" marker-end="url(#arrowhead-purple)"/>
  <text x="447" y="253" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#7c3aed">Connections</text>

  <!-- UI reads status -->
  <path d="M 80 180 L 80 280 L 157 280" stroke="#7c3aed" stroke-width="1" stroke-dasharray="4,3" fill="none" marker-end="url(#arrowhead-purple)"/>
  <text x="55" y="235" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#7c3aed">UI reads</text>
  <text x="55" y="245" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#7c3aed">status</text>

  <!-- Legend -->
  <g transform="translate(30, 350)">
    <rect x="0" y="0" width="890" height="55" rx="6" fill="white" stroke="#e2e8f0" stroke-width="1"/>
    <text x="20" y="20" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#64748b">Flow:</text>

    <text x="60" y="20" font-family="Arial, sans-serif" font-size="10" fill="#374151"><tspan font-weight="bold">1</tspan> Trigger DAG</text>
    <text x="150" y="20" font-family="Arial, sans-serif" font-size="10" fill="#374151"><tspan font-weight="bold">2</tspan> Start Workflow</text>
    <text x="270" y="20" font-family="Arial, sans-serif" font-size="10" fill="#374151"><tspan font-weight="bold">3</tspan> Dispatch to Worker</text>
    <text x="410" y="20" font-family="Arial, sans-serif" font-size="10" fill="#374151"><tspan font-weight="bold">4</tspan> Execute Tasks</text>
    <text x="530" y="20" font-family="Arial, sans-serif" font-size="10" fill="#374151"><tspan font-weight="bold">5</tspan> Sync Status</text>

    <line x1="640" y1="15" x2="670" y2="15" stroke="#7c3aed" stroke-width="1" stroke-dasharray="4,3" marker-end="url(#arrowhead-purple)"/>
    <text x="680" y="19" font-family="Arial, sans-serif" font-size="10" fill="#374151">Read from DB</text>

    <text x="20" y="45" font-family="Arial, sans-serif" font-size="10" fill="#64748b">Temporal handles retries, timeouts, and failure recovery. Airflow UI shows real-time status via sync activities.</text>
  </g>
</svg>
